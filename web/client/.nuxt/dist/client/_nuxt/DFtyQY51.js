import{_ as j}from"./DusBHTda.js";import{B as q}from"./DZyT-3wr.js";import{S as D}from"./BC6OM_U-.js";import{I as z}from"./DRQ8spOm.js";import{S as H,O as K}from"./lDd3phAc.js";import"./BiNgaM9F.js";import"./CWvt8Gu3.js";import{F as Q,a as W}from"./DcU8bM7c.js";import{T as X}from"./k-1F5wz5.js";import{_ as I}from"./C4Ghd-f4.js";import{p as Y,i as Z,h as ee,l as T,r as c,e as k,x as te,c as w,a as n,b as s,w as r,j as l,q as f,o as m,s as v,g as B,F,v as N,d as p,t as G}from"./CbujNTzC.js";import{u as oe}from"./DrTY0QbX.js";import{_ as ae}from"./DlAUqK2U.js";import{M as i}from"./C4FomA2R.js";import"./Do3eBRyU.js";import"./7FLWgqLH.js";import"./Ba22RDed.js";import"./CYhUeftq.js";import"./C2r7KKOo.js";import"./BgSTSfhd.js";const le={class:"Pageas"},se={class:"PageContent"},re={class:"ConBox"},ne={class:"RightBox"},ie={class:"Items"},de={__name:"[id]",async setup(ue){let g,x;const y=Y().params.id,O=Z();ee().init(t=>{t||(i.error("请先登录"),T("/login"))}),oe({title:"添加内容 - "+O.$state.Config.n_web_title});const S=c(!1);k(()=>{S.value=!0});const o=c({n_name:"",n_profile:"",n_html:"",n_category:[],n_topic:[],n_permission:"1"}),d=c([]),L=t=>{d.value=t,console.log("当前资源列表:",d.value)},R=async()=>{let t={...o.value,n_category:JSON.stringify(o.value.n_category),n_topic:JSON.stringify(o.value.n_topic),n_resources:JSON.stringify(d.value),n_haveimage:2,n_havevideo:2};if(d.value.length>0)for(let e in d.value)d.value[e].type==1&&(t.n_haveimage=1),d.value[e].type==2&&(t.n_havevideo=1);try{let e;y=="add"?e=await f().post("/api/AddThreads",t):e=await f().post("/api/EditThreads",t),e.code==200?i.success("提交成功"):i.error(e.message||"提交失败")}catch(e){i.error(e.message)}},h=c([]),A=async()=>{try{const t=await f().post("/api/GetCategory");t.code==200?h.value=t.data:i.error(t.message||"获取分类列表失败")}catch(t){i.error(t.message)}},C=c([]),E=async()=>{try{const t=await f().post("/api/GetCategory",{type:2});t.code==200?C.value=t.data:i.error(t.message||"获取分类列表失败")}catch(t){i.error(t.message)}};if(k(()=>{A(),E()}),y!="add"){const t=([g,x]=te(()=>f().post("/api/GetThreads",{id:y})),g=await g,x(),g);if(t.code===200){o.value=t.data,o.value.n_category=[],o.value.n_topic=[];for(let e in t.data.category)t.data.category[e].n_type=="1"?o.value.n_category.push(t.data.category[e].id):o.value.n_topic.push(t.data.category[e].id)}else T("/threads/404")}return(t,e)=>{const b=z,u=W,J=X,M=j,U=Q,_=K,V=H,$=D,P=q;return m(),w("div",le,[n("div",se,[n("div",re,[e[8]||(e[8]=n("div",{class:"title"},[n("img",{src:I,alt:""}),n("span",null,"我有话要说")],-1)),s(U,{model:l(o),layout:"vertical"},{default:r(()=>[s(u,{field:"name",label:"标题"},{default:r(()=>[s(b,{class:"road",modelValue:l(o).n_name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(o).n_name=a),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),s(u,{field:"post",label:"简介"},{default:r(()=>[s(J,{class:"road",modelValue:l(o).n_profile,"onUpdate:modelValue":e[1]||(e[1]=a=>l(o).n_profile=a),placeholder:"请输入简介","max-length":200,"allow-clear":"","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(u,{field:"post",label:"详情"},{default:r(()=>[l(S)?(m(),v(M,{key:0,modelValue:l(o).n_html,"onUpdate:modelValue":e[2]||(e[2]=a=>l(o).n_html=a),height:200,"onUpdate:resources":L},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["model"])]),n("div",ne,[n("div",ie,[e[13]||(e[13]=n("div",{class:"title"},[n("img",{src:I,alt:""}),n("span",null,"确认信息")],-1)),s(U,{model:l(o),layout:"vertical"},{default:r(()=>[s(u,{field:"post",label:"分类"},{default:r(()=>[s(V,{multiple:"",class:"road","max-tag-count":2,"allow-clear":"",modelValue:l(o).n_category,"onUpdate:modelValue":e[3]||(e[3]=a=>l(o).n_category=a),placeholder:"请选择分类"},{default:r(()=>[(m(!0),w(F,null,N(l(h),a=>(m(),v(_,{key:a.id,value:a.id},{default:r(()=>[p(G(a.n_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{field:"post",label:"话题"},{default:r(()=>[s(V,{multiple:"",class:"road","max-tag-count":2,"allow-clear":"",modelValue:l(o).n_topic,"onUpdate:modelValue":e[4]||(e[4]=a=>l(o).n_topic=a),placeholder:"请选择话题"},{default:r(()=>[(m(!0),w(F,null,N(l(C),a=>(m(),v(_,{key:a.id,value:a.id},{default:r(()=>[p(G(a.n_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{field:"post",label:"权限"},{default:r(()=>[s($,null,{default:r(()=>[s(V,{class:"road",modelValue:l(o).n_permission,"onUpdate:modelValue":e[5]||(e[5]=a=>l(o).n_permission=a),placeholder:"请选择"},{default:r(()=>[s(_,{value:"1"},{default:r(()=>[...e[9]||(e[9]=[p("免费公开",-1)])]),_:1}),s(_,{value:"2"},{default:r(()=>[...e[10]||(e[10]=[p("积分公开",-1)])]),_:1}),s(_,{value:"3"},{default:r(()=>[...e[11]||(e[11]=[p("付费公开",-1)])]),_:1})]),_:1},8,["modelValue"]),l(o).n_permission!=="1"?(m(),v(b,{key:0,class:"road",modelValue:l(o).n_price,"onUpdate:modelValue":e[6]||(e[6]=a=>l(o).n_price=a),placeholder:"请输入价格"},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1}),s(u,{field:"post",label:""},{default:r(()=>[s(P,{type:"primary",class:"road",onClick:e[7]||(e[7]=a=>R())},{default:r(()=>[...e[12]||(e[12]=[p("提交",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])])])}}},Ge=ae(de,[["__scopeId","data-v-aa5f98ec"]]);export{Ge as default};
