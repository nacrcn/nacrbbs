{"version":3,"file":"RichInput-Cb98n3LG.js","sources":["../../../../components/RichInput.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted, onBeforeUnmount, watch } from 'vue'\r\nimport '@wangeditor/editor/dist/css/style.css'\r\nimport { upimg, upfile } from '@/Tools/update' // 你的上传函数\r\nconst props = defineProps({\r\n    modelValue: {\r\n        type: String,\r\n        default: '',\r\n    },\r\n    placeholder: {\r\n        type: String,\r\n        default: '请输入内容...',\r\n    },\r\n    height: {\r\n        type: Number,\r\n        default: 300,\r\n    },\r\n})\r\n\r\nconst emit = defineEmits(['update:modelValue', 'update:resources'])\r\n\r\nconst editorRef = ref(null)\r\nconst toolbarRef = ref(null)\r\nlet editorInstance = null\r\n\r\n// 提取HTML中的资源链接\r\nconst extractResources = (html) => {\r\n    const resources = []\r\n\r\n    // 提取图片链接\r\n    const imgRegex = /<img[^>]+src=[\"']([^\"']+)[\"'][^>]*>/g\r\n    let match\r\n    while ((match = imgRegex.exec(html)) !== null) {\r\n        resources.push({\r\n            type: 1,\r\n            url: match[1]\r\n        })\r\n    }\r\n\r\n    // 提取视频链接\r\n    const videoRegex = /<video[^>]*>\\s*<source[^>]+src=[\"']([^\"']+)[\"'][^>]*>\\s*<\\/video>/g\r\n    while ((match = videoRegex.exec(html)) !== null) {\r\n        resources.push({\r\n            type: 2,\r\n            url: match[1]\r\n        })\r\n    }\r\n\r\n    return resources.sort((a, b) => b.type - a.type)\r\n}\r\n\r\n// 同步资源列表到父组件\r\nconst syncResources = () => {\r\n    if (!editorInstance) return\r\n    const html = editorInstance.getHtml()\r\n    const resources = extractResources(html)\r\n    emit('update:resources', resources)\r\n}\r\n\r\nonMounted(async () => {\r\n    if (!process.client) return\r\n\r\n    const { createEditor, createToolbar } = await import('@wangeditor/editor')\r\n\r\n    editorInstance = createEditor({\r\n        selector: editorRef.value,\r\n        config: {\r\n            placeholder: props.placeholder,\r\n            onChange(editor) {\r\n                const html = editor.getHtml()\r\n                emit('update:modelValue', html)\r\n                // 同步资源列表\r\n                syncResources()\r\n            },\r\n            MENU_CONF: {\r\n                // 可在这里配置上传图片等功能\r\n                uploadImage: {\r\n                    async customUpload(file, insertFn) {\r\n                        const res = await upimg(file, () => { })\r\n                        insertFn(res.data.url)\r\n                        // 上传后同步资源列表\r\n                        setTimeout(() => syncResources(), 100)\r\n                    }\r\n                },\r\n                uploadVideo: {\r\n                    async customUpload(file, insertFn) {\r\n                        const res = await upfile(file, () => { })\r\n                        insertFn(res.data.url)\r\n                        // 上传后同步资源列表\r\n                        setTimeout(() => syncResources(), 100)\r\n                    }\r\n                }\r\n            },\r\n        },\r\n        html: props.modelValue,\r\n        mode: 'default',\r\n    })\r\n\r\n    createToolbar({\r\n        editor: editorInstance,\r\n        selector: toolbarRef.value,\r\n        config: {},\r\n        mode: 'default',\r\n    })\r\n\r\n    // 初始化时同步一次资源列表\r\n    setTimeout(() => syncResources(), 100)\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n    if (editorInstance) {\r\n        editorInstance.destroy()\r\n        editorInstance = null\r\n    }\r\n})\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <div ref=\"toolbarRef\" style=\"border-bottom: 1px solid #ccc;\" />\r\n        <div ref=\"editorRef\" :style=\"`min-height: ${height}px; padding: 10px;`\" />\r\n    </div>\r\n</template>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBkB,QAAI,IAAI;AACP,QAAI,IAAI;;wEAiGG,EAAA,iBAAA,iBAAA,CAAsC,sDAChB,QAAA,MAAM,oBAAA;;;;;;;;;;"}